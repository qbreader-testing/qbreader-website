import getBonusPartLabel from"../../scripts/utilities/get-bonus-part-label.js";import QuestionCard from"../../scripts/components/QuestionCard.min.js";import{CATEGORY_TO_ALTERNATE_SUBCATEGORIES,SUBCATEGORY_TO_CATEGORY}from"../../../quizbowl/categories.js";const fontSize="true"===window.localStorage.getItem("database-font-size")?window.localStorage.getItem("font-size")??16:16;function TossupCard({tossup:a}){const b=a._id,c=a.packet.name;return/*#__PURE__*/React.createElement(QuestionCard,{onClickHeader:"collapse",question:a},/*#__PURE__*/React.createElement("div",{className:"card-body",style:{fontSize:`${fontSize}px`}},/*#__PURE__*/React.createElement("span",{style:{fontWeight:"<b>"===a.question.substring(0,3)?"bold":"normal"}},a.number,". "),/*#__PURE__*/React.createElement("span",{dangerouslySetInnerHTML:{__html:a.question}}),/*#__PURE__*/React.createElement("hr",{className:"my-3"}),/*#__PURE__*/React.createElement("div",null,/*#__PURE__*/React.createElement("b",null,"ANSWER:")," ",/*#__PURE__*/React.createElement("span",{dangerouslySetInnerHTML:{__html:a?.answer}}))),/*#__PURE__*/React.createElement("div",{className:"card-footer clickable",onClick:function(){document.getElementById("old-category").value=`${a.category} / ${a.subcategory}`,document.getElementById("question-id").value=b,document.getElementById("question-type").textContent="tossup";const c=a.reports.map(a=>a.description).join("; ")||"None given";document.getElementById("report-reason").value=c},id:`fix-category-${b}`,"data-bs-toggle":"modal","data-bs-target":"#fix-category-modal"},/*#__PURE__*/React.createElement("small",{className:"text-muted"},c?"Packet "+c:/*#__PURE__*/React.createElement("span",null,"\xA0")),/*#__PURE__*/React.createElement("small",{className:"text-muted float-end"},/*#__PURE__*/React.createElement("a",{href:"javascript:void(0);"},"Fix Category"))))}function BonusCard({bonus:a}){const b=a._id,c=a.packet.name,d=a.parts.length,e=[];for(let b=0;b<d;b++)e.push(b);return/*#__PURE__*/React.createElement(QuestionCard,{onClickHeader:"collapse",question:a},/*#__PURE__*/React.createElement("div",{className:"card-body"},/*#__PURE__*/React.createElement("span",{style:{fontWeight:"<b>"===a.leadin.substring(0,3)?"bold":"normal"}},a.number,". "),/*#__PURE__*/React.createElement("span",{dangerouslySetInnerHTML:{__html:a.leadin}}),e.map(b=>/*#__PURE__*/React.createElement("div",{key:`${a._id}-${b}`},/*#__PURE__*/React.createElement("hr",null),/*#__PURE__*/React.createElement("p",null,getBonusPartLabel(b)," ",/*#__PURE__*/React.createElement("span",{dangerouslySetInnerHTML:{__html:a.parts[b]}})),/*#__PURE__*/React.createElement("b",null,"ANSWER: "),/*#__PURE__*/React.createElement("span",{dangerouslySetInnerHTML:{__html:a?.answers[b]}})))),/*#__PURE__*/React.createElement("div",{className:"card-footer clickable",onClick:function(){document.getElementById("old-category").value=`${a.category} / ${a.subcategory}`,document.getElementById("question-id").value=b,document.getElementById("question-type").textContent="bonus";const c=a.reports.map(a=>a.description).join("; ")||"None given";document.getElementById("report-reason").value=c},"data-bs-toggle":"modal","data-bs-target":"#fix-category-modal"},/*#__PURE__*/React.createElement("small",{className:"text-muted"},c?"Packet "+c:/*#__PURE__*/React.createElement("span",null,"\xA0")),/*#__PURE__*/React.createElement("small",{className:"text-muted float-end"},/*#__PURE__*/React.createElement("a",{href:"javascript:void(0);"},"Fix Category"))))}function Reports(){let[a,b]=React.useState([]),[c,d]=React.useState([]);return React.useEffect(()=>{fetch("/api/admin/list-reports?"+new URLSearchParams({reason:"wrong-category"})).then(a=>a.json()).then(e=>{a=e.tossups,c=e.bonuses,b(a),d(c)}),document.getElementById("clear-reports-submit").addEventListener("click",function(){const e=document.getElementById("question-id").value,f=document.getElementById("question-type").textContent;this.disabled=!0,this.textContent="Clearing...",fetch("/api/admin/clear-reports",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e,type:f})}).then(g=>(document.getElementById("fix-category-close").click(),this.disabled=!1,this.textContent="Clear Reports",!g.ok)?void window.alert(`Error clearing reports for ${f} ${e}`):void("tossup"===f?(a=a.filter(a=>a._id!==e),b(a)):"bonus"===f?(c=c.filter(a=>a._id!==e),d(c)):void 0))}),document.getElementById("fix-category-submit").addEventListener("click",function(){const e=document.getElementById("question-id").value,f=document.getElementById("question-type").textContent;this.disabled=!0,this.textContent="Submitting...",fetch("/api/admin/update-subcategory",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e,type:f,subcategory:document.getElementById("new-category").value,alternate_subcategory:document.getElementById("new-alternate-subcategory").value})}).then(g=>(document.getElementById("fix-category-close").click(),this.disabled=!1,this.textContent="Submit",!g.ok)?void window.alert("Error updating subcategory"):void("tossup"===f?(a=a.filter(a=>a._id!==e),b(a)):"bonus"===f?(c=c.filter(a=>a._id!==e),d(c)):void 0))})},[]),/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement("div",{className:"row text-center"},/*#__PURE__*/React.createElement("h3",{id:"tossups"},"Tossups")),/*#__PURE__*/React.createElement("div",{className:"float-row mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-muted float-start"},"Showing ",a.length," tossups"),/*#__PURE__*/React.createElement("a",{className:"float-end",href:"#bonuses"},"Jump to bonuses")),a.map(a=>/*#__PURE__*/React.createElement(TossupCard,{key:a._id,tossup:a})),/*#__PURE__*/React.createElement("div",{className:"row text-center mt-5"},/*#__PURE__*/React.createElement("h3",{id:"bonuses"},"Bonuses")),/*#__PURE__*/React.createElement("div",{className:"float-row mb-3"},/*#__PURE__*/React.createElement("span",{className:"text-muted float-start"},"Showing ",c.length," bonuses"),/*#__PURE__*/React.createElement("a",{className:"float-end",href:"#tossups"},"Jump to tossups")),c.map(a=>/*#__PURE__*/React.createElement(BonusCard,{key:a._id,bonus:a})))}document.getElementById("new-category").addEventListener("input",function(){const a=this.value,b=SUBCATEGORY_TO_CATEGORY[a];let c=[];"Literature"===b?c=CATEGORY_TO_ALTERNATE_SUBCATEGORIES[b]:["Other Science","Other Fine Arts","Social Science"].includes(a)&&(c=CATEGORY_TO_ALTERNATE_SUBCATEGORIES[b]);const d=document.getElementById("new-alternate-subcategory");d.innerHTML="";for(const a of c){const b=document.createElement("option");b.value=a,b.textContent=a,d.appendChild(b)}0===c.length?document.getElementById("alternate-subcategory-selection").classList.add("d-none"):(document.getElementById("alternate-subcategory-selection").classList.remove("d-none"),d.value=c.at(-1))});const root=ReactDOM.createRoot(document.getElementById("root"));root.render(/*#__PURE__*/React.createElement(Reports,null));